# This script was created by Tom Oliver in September 2019. It pulls data directly from NOAA's Coral Reef Watch
#Website and generates simplified SST and DHW figures.
# Library Load ------------------------------------------------------------
library(plyr)
library(ggplot2)
library(stringr)
library(viridis)
library(lubridate)
library(tidyverse)
library(curl)
# Data Load ------------------------------------------------------------
MHI_Temp_URL="https://coralreefwatch.noaa.gov/vs/data/hawaii.txt"
NWHI_Temp_URL="https://coralreefwatch.noaa.gov/vs/data/nwhi.txt"
MHI=read_table2(curl(url = MHI_Temp_URL),skip=21,progress = T,col_types = "dddddddddd")
NWHI=read_table2(curl(url = NWHI_Temp_URL),skip=21,progress = T,col_types = "dddddddddd")
#  Data Prep For Plotting -------------------------------------------------
#MHI
MHI$R_Date=ymd(paste(MHI$YYYY,MHI$MM,MHI$DD,sep="/"))
MHI$MM0=MHI$MM-1
MonthDays=ddply(MHI,.(MM0),summarize,MaxDays=max(DD))
MHI$FracMonth=MHI$MM0+MHI$DD/MonthDays$MaxDays[match(MHI$MM0,MonthDays$MM0)]
MHI=MHI[order(MHI$R_Date),]
MHI$frame=1:nrow(MHI)
MHI$SSTvalue=MHI$"SST@90th_HS"
MHI$DHWvalue=MHI$"DHW_from_90th_HS>1"
MHI$month=MHI$FracMonth
MHI$year=MHI$YYYY
#NWHI
NWHI$R_Date=ymd(paste(NWHI$YYYY,NWHI$MM,NWHI$DD,sep="/"))
NWHI$MM0=NWHI$MM-1
MonthDays=ddply(NWHI,.(MM0),summarize,MaxDays=max(DD))
NWHI$FracMonth=NWHI$MM0+NWHI$DD/MonthDays$MaxDays[match(NWHI$MM0,MonthDays$MM0)]
NWHI=NWHI[order(NWHI$R_Date),]
NWHI$frame=1:nrow(NWHI)
NWHI$SSTvalue=NWHI$"SST@90th_HS"
NWHI$DHWvalue=NWHI$"DHW_from_90th_HS>1"
NWHI$month=NWHI$FracMonth
NWHI$year=NWHI$YYYY
#Titles
titleMHISST="Sea Surface Temperature: Hawai'i Virtual Station (1985 - 2019)"
titleMHIDHW="Degree Heating Week: Hawai'i Virtual Station (1985 - 2019)"#"Sea Surface Temperature: Hawai'i Virtual Station (1985 - 2019)"
titleNWHISST="Sea Surface Temperature: Northwestern Hawai'i Virtual Station (1985 - 2019)"
titleNWHIDHW="Degree Heating Week:Northwestern Hawai'i Virtual Station (1985 - 2019)"#"Sea Surface Temperature: Hawai'i Virtual Station (1985 - 2019)"
OutPath="V:/VirtualStationPlots/"
DHWout=ggplot(MHI, aes(x = month, y = DHWvalue)) +
geom_hline(yintercept = 8,color="red",lty=5) +
geom_text(x=2.5,y=8.1,label="Bleaching Alert Level 2",color="red") +
geom_hline(yintercept = 4,color="orange",lty=5) +
geom_text(x=2.5,y=4.1,label="Bleaching Alert Level 1",color="orange") +
geom_line(aes(group = year),color="gray75") +
geom_line(aes(group = year),color="darkblue",data=subset(MHI,year=="1996"),size=1.5) +
geom_text(x=10,y=1,label="1996",color="darkblue",size=8) +
geom_line(aes(group = year),color="darkgreen",data=subset(MHI,year=="2014"),size=1.5) +
geom_text(x=10,y=5.5,label="2014",color="darkgreen",size=8) +
geom_line(aes(group = year),color="orange",data=subset(MHI,year=="2015"),size=1.5) +
geom_text(x=9,y=12,label="2015",color="orange",size=8) +
geom_line(aes(group = year),color="red",data=subset(MHI,year=="2019"),size=1.5) +
geom_text(x=7.5,y=6,label="2019",color="red",size=8) +
scale_y_continuous(breaks =seq(0,20,5),name="Degree Heating Week")+
scale_x_continuous(breaks = seq(0, 12, 1),
labels = c("Jan", "Feb", "Mar", "Apr","May", "Jun", "Jul", "Aug","Sep", "Oct", "Nov", "Dec","Jan"),
name="Month")+
ggtitle(paste0("Main Hawaiian Islands, 1985-2019
NOAA CRW Virtual Station: Degree Heating Week (90th Percentile)
Data up to: ",max(MHI$R_Date)))
DHWout
DHWout=ggplot(MHI, aes(x = month, y = DHWvalue)) +
geom_hline(yintercept = 8,color="red",lty=5) +
geom_text(x=2.5,y=8.1,label="Bleaching Alert Level 2",color="red") +
geom_hline(yintercept = 4,color="orange",lty=5) +
geom_text(x=2.5,y=4.1,label="Bleaching Alert Level 1",color="orange") +
geom_line(aes(group = year),color="gray75") +
geom_line(aes(group = year),color="darkblue",data=subset(MHI,year=="1996"),size=1.5) +
geom_text(x=10,y=1,label="1996",color="darkblue",size=8) +
geom_line(aes(group = year),color="darkgreen",data=subset(MHI,year=="2014"),size=1.5) +
geom_text(x=10,y=5.5,label="2014",color="darkgreen",size=8) +
geom_line(aes(group = year),color="orange",data=subset(MHI,year=="2015"),size=1.5) +
geom_text(x=9,y=12,label="2015",color="orange",size=8) +
geom_line(aes(group = year),color="red",data=subset(MHI,year=="2019"),size=1.5) +
geom_text(x=7.5,y=6,label="2019",color="red",size=8) +
scale_y_continuous(breaks =seq(0,20,2),name="Degree Heating Week")+
scale_x_continuous(breaks = seq(0, 12, 1),
labels = c("Jan", "Feb", "Mar", "Apr","May", "Jun", "Jul", "Aug","Sep", "Oct", "Nov", "Dec","Jan"),
name="Month")+
ggtitle(paste0("Main Hawaiian Islands, 1985-2019
NOAA CRW Virtual Station: Degree Heating Week (90th Percentile)
Data up to: ",max(MHI$R_Date)))
DHWout
# This script was created by Tom Oliver in September 2019. It pulls data directly from NOAA's Coral Reef Watch
#Website and generates simplified SST and DHW figures.
# Library Load ------------------------------------------------------------
library(plyr)
library(ggplot2)
library(stringr)
library(viridis)
library(lubridate)
library(tidyverse)
library(curl)
# Data Load ------------------------------------------------------------
MHI_Temp_URL="https://coralreefwatch.noaa.gov/vs/data/hawaii.txt"
NWHI_Temp_URL="https://coralreefwatch.noaa.gov/vs/data/nwhi.txt"
MHI=read_table2(curl(url = MHI_Temp_URL),skip=21,progress = T,col_types = "dddddddddd")
NWHI=read_table2(curl(url = NWHI_Temp_URL),skip=21,progress = T,col_types = "dddddddddd")
#  Data Prep For Plotting -------------------------------------------------
#MHI
MHI$R_Date=ymd(paste(MHI$YYYY,MHI$MM,MHI$DD,sep="/"))
MHI$MM0=MHI$MM-1
MonthDays=ddply(MHI,.(MM0),summarize,MaxDays=max(DD))
MHI$FracMonth=MHI$MM0+MHI$DD/MonthDays$MaxDays[match(MHI$MM0,MonthDays$MM0)]
MHI=MHI[order(MHI$R_Date),]
MHI$frame=1:nrow(MHI)
MHI$SSTvalue=MHI$"SST@90th_HS"
MHI$DHWvalue=MHI$"DHW_from_90th_HS>1"
MHI$month=MHI$FracMonth
MHI$year=MHI$YYYY
#NWHI
NWHI$R_Date=ymd(paste(NWHI$YYYY,NWHI$MM,NWHI$DD,sep="/"))
NWHI$MM0=NWHI$MM-1
MonthDays=ddply(NWHI,.(MM0),summarize,MaxDays=max(DD))
NWHI$FracMonth=NWHI$MM0+NWHI$DD/MonthDays$MaxDays[match(NWHI$MM0,MonthDays$MM0)]
NWHI=NWHI[order(NWHI$R_Date),]
NWHI$frame=1:nrow(NWHI)
NWHI$SSTvalue=NWHI$"SST@90th_HS"
NWHI$DHWvalue=NWHI$"DHW_from_90th_HS>1"
NWHI$month=NWHI$FracMonth
NWHI$year=NWHI$YYYY
#Titles
titleMHISST="Sea Surface Temperature: Hawai'i Virtual Station (1985 - 2019)"
titleMHIDHW="Degree Heating Week: Hawai'i Virtual Station (1985 - 2019)"#"Sea Surface Temperature: Hawai'i Virtual Station (1985 - 2019)"
titleNWHISST="Sea Surface Temperature: Northwestern Hawai'i Virtual Station (1985 - 2019)"
titleNWHIDHW="Degree Heating Week:Northwestern Hawai'i Virtual Station (1985 - 2019)"#"Sea Surface Temperature: Hawai'i Virtual Station (1985 - 2019)"
OutPath="T:/Benthic/Projects/MHI NWHI 2019 Coral Bleaching/CRW Plots"
#MHI
SSTout=ggplot(MHI, aes(x = month, y = SSTvalue)) +
geom_hline(yintercept = 27.9824,color="red",lty=5) +
geom_text(x=2.5,y=28.2,label="MHI Bleaching Threshold",color="red") +
geom_hline(yintercept = 26.9824,color="darkblue",lty=5) +
geom_text(x=2.5,y=27.2,label="MHI Max Monthly Mean SST",color="darkblue") +
geom_line(aes(group = year),color="gray75") +
geom_line(aes(group = year),color="darkblue",data=subset(MHI,year=="1996"),size=1.5) +
geom_text(x=11.5,y=24.5,label="1996",color="darkblue",size=6) +
geom_line(aes(group = year),color="darkgreen",data=subset(MHI,year=="2014"),size=1.5) +
geom_text(x=10,y=29,label="2014",color="darkgreen",size=6) +
geom_line(aes(group = year),color="orange",data=subset(MHI,year=="2015"),size=1.5) +
geom_text(x=7.5,y=29,label="2015",color="orange",size=6) +
geom_line(aes(group = year),color="red",data=subset(MHI,year=="2019"),size=1.5) +
geom_text(x=6.5,y=28.5,label="2019",color="red",size=6) +
scale_y_continuous(name="Sea Surface Temperature (deg. C)")+
scale_x_continuous(breaks = seq(0, 12, 1),
labels = c("Jan", "Feb", "Mar", "Apr","May", "Jun", "Jul", "Aug","Sep", "Oct", "Nov", "Dec","Jan"),
name="Month")+
ggtitle(paste0("Main Hawaiian Islands, 1985-2019
NOAA CRW Virtual Station: Sea Surface Temperature (90th Percentile)
Data up to: ",max(MHI$R_Date)))
SSTout
ggsave(plot=SSTout,
filename=paste0(OutPath,"/MHI_SST_",max(MHI$R_Date),".png"),
height = 5,width=12)
DHWout=ggplot(MHI, aes(x = month, y = DHWvalue)) +
geom_hline(yintercept = 8,color="red",lty=5) +
geom_text(x=2.5,y=8.1,label="Bleaching Alert Level 2",color="red") +
geom_hline(yintercept = 4,color="orange",lty=5) +
geom_text(x=2.5,y=4.1,label="Bleaching Alert Level 1",color="orange") +
geom_line(aes(group = year),color="gray75") +
geom_line(aes(group = year),color="darkblue",data=subset(MHI,year=="1996"),size=1.5) +
geom_text(x=10,y=1,label="1996",color="darkblue",size=8) +
geom_line(aes(group = year),color="darkgreen",data=subset(MHI,year=="2014"),size=1.5) +
geom_text(x=10,y=5.5,label="2014",color="darkgreen",size=8) +
geom_line(aes(group = year),color="orange",data=subset(MHI,year=="2015"),size=1.5) +
geom_text(x=9,y=12,label="2015",color="orange",size=8) +
geom_line(aes(group = year),color="red",data=subset(MHI,year=="2019"),size=1.5) +
geom_text(x=7.5,y=6,label="2019",color="red",size=8) +
scale_y_continuous(breaks =seq(0,20,2),name="Degree Heating Week")+
scale_x_continuous(breaks = seq(0, 12, 1),
labels = c("Jan", "Feb", "Mar", "Apr","May", "Jun", "Jul", "Aug","Sep", "Oct", "Nov", "Dec","Jan"),
name="Month")+
ggtitle(paste0("Main Hawaiian Islands, 1985-2019
NOAA CRW Virtual Station: Degree Heating Week (90th Percentile)
Data up to: ",max(MHI$R_Date)))
DHWout
ggsave(plot=DHWout,
filename=paste0(OutPath,"/MHI_DHW_",max(MHI$R_Date),".png"),
height = 5,width=12)
#NWHI
SSToutNWHI=ggplot(NWHI, aes(x = month, y = SSTvalue)) +
geom_hline(yintercept = 27.9824,color="red",lty=5) +
geom_text(x=2.5,y=28.2,label="NWHI Bleaching Threshold",color="red") +
geom_hline(yintercept = 26.9824,color="darkblue",lty=5) +
geom_text(x=2.5,y=27.2,label="NWHI Max Monthly Mean SST",color="darkblue") +
geom_line(aes(group = year),color="gray75") +
geom_line(aes(group = year),color="darkblue",data=subset(NWHI,year=="2002"),size=1.5) +
geom_text(x=11.5,y=23.5,label="2002",color="darkblue",size=6) +
geom_line(aes(group = year),color="darkgreen",data=subset(NWHI,year=="2004"),size=1.5) +
geom_text(x=7,y=26,label="2004",color="darkgreen",size=6) +
geom_line(aes(group = year),color="orange1",data=subset(NWHI,year=="2014"),size=1.5) +
geom_text(x=10,y=29,label="2014",color="orange1",size=6) +
geom_line(aes(group = year),color="orange4",data=subset(NWHI,year=="2015"),size=1.5) +
geom_text(x=10.5,y=28,label="2015",color="orange4",size=6) +
geom_line(aes(group = year),color="red",data=subset(NWHI,year=="2019"),size=1.5) +
geom_text(x=6.5,y=28.75,label="2019",color="red",size=6) +
scale_y_continuous(name="Sea Surface Temperature (deg. C)")+
scale_x_continuous(breaks = seq(0, 12, 1),
labels = c("Jan", "Feb", "Mar", "Apr","May", "Jun", "Jul", "Aug","Sep", "Oct", "Nov", "Dec","Jan"),
name="Month")+
ggtitle(paste0("Northwestern Hawaiian Islands, 1985-2019
NOAA CRW Virtual Station: Sea Surface Temperature (90th Percentile)
Data up to: ",max(NWHI$R_Date)))
SSToutNWHI
ggsave(plot=SSToutNWHI,
filename=paste0(OutPath,"/NWHI_SST_",max(NWHI$R_Date),".png"),
height = 5,width=12)
DHWoutNWHI=ggplot(NWHI, aes(x = month, y = DHWvalue)) +
geom_hline(yintercept = 8,color="red",lty=5) +
geom_text(x=2.5,y=8.25,label="Bleaching Alert Level 2",color="red") +
geom_hline(yintercept = 4,color="orange",lty=5) +
geom_text(x=2.5,y=4.25,label="Bleaching Alert Level 1",color="orange") +
geom_line(aes(group = year),color="gray75") +
geom_line(aes(group = year),color="darkblue",data=subset(NWHI,year=="2002"),size=1.5) +
geom_text(x=9,y=6,label="2002",color="darkblue",size=8) +
geom_line(aes(group = year),color="darkgreen",data=subset(NWHI,year=="2004"),size=1.5) +
geom_text(x=9,y=8,label="2004",color="darkgreen",size=8) +
geom_line(aes(group = year),color="orange1",data=subset(NWHI,year=="2014"),size=1.5) +
geom_text(x=10.75,y=17,label="2014",color="orange1",size=8) +
geom_line(aes(group = year),color="orange3",data=subset(NWHI,year=="2015"),size=1.5) +
geom_text(x=9.5,y=13,label="2015",color="orange3",size=8) +
geom_line(aes(group = year),color="red",data=subset(NWHI,year=="2019"),size=1.5) +
geom_text(x=7.5,y=17,label="2019",color="red",size=8) +
scale_y_continuous(name="Degree Heating Week")+
scale_x_continuous(breaks = seq(0, 12, 1),
labels = c("Jan", "Feb", "Mar", "Apr","May", "Jun", "Jul", "Aug","Sep", "Oct", "Nov", "Dec","Jan"),
name="Month")+
ggtitle(paste0("Northwestern Hawaiian Islands, 1985-2019
NOAA CRW Virtual Station: Degree Heating Week (90th Percentile)
Data up to: ",max(NWHI$R_Date)))
DHWoutNWHI
ggsave(plot=DHWoutNWHI,
filename=paste0(OutPath,"/NWHI_DHW_",max(NWHI$R_Date),".png"),
height = 5,width=12)
