r_text<-paste("RMSE = ", round(rmse,digits = 2),"\n r = ", round((corr$estimate),2), sep="")
p1<-ggplot(d, aes(x=X, y=Y)) +
geom_point(size=1) + 	geom_abline(slope=1, intercept=0) +
geom_smooth(method="lm", color="red", linetype="dashed", se=F) +
geom_label(aes((mx_val/5), (mx_val * 0.9), label=r_text), nudge_y=-0.1, nudge_x=0.1,label.size=0.35, color="black", fill="white") +
theme_bw()+
scale_x_continuous(limits=c(0,mx_val)) +
scale_y_continuous(limits=c(0,mx_val)) +
ylab(r_name) +  xlab(p_name)
return(p1)
} #
p1<-Plot1to1_new(s.wide,"Diver_AdColDen","SfM_AdColDen")
p1
p1<-Plot1to1_new(s.wide,"Diver_AdColDen","SfM_AdColDen","SfM Adult Density","Diver Adult Density")
p1
cor.test
?cor.test
s.wide<-subset(site.wide,GENUS_CODE=="SSSS")
Plot1to1_new<-function(d,response_variable,predictor_variable,r_name,p_name){
#sub<-d[d$taxon,]
d$Y<-d[,response_variable]
d$X<-d[,predictor_variable]
mx_val<-max(d$Y, d$X, na.rm = TRUE)
corr<-cor.test(d$X, d$Y, method="pearson")
rmse<-rmse(d$Y, d$X,na.rm=TRUE)
r_text<-paste("RMSE = ", round(rmse,digits = 2),"\n r = ", round((corr$estimate),2), sep="")
p1<-ggplot(d, aes(x=X, y=Y)) +
geom_point(size=1) + 	geom_abline(slope=1, intercept=0) +
geom_smooth(method="lm", color="red", linetype="dashed", se=F) +
geom_label(aes((mx_val/5), (mx_val * 0.9), label=r_text), nudge_y=-0.1, nudge_x=0.1,label.size=0.35, color="black", fill="white") +
theme_bw()+
scale_x_continuous(limits=c(0,mx_val)) +
scale_y_continuous(limits=c(0,mx_val)) +
ylab(r_name) +  xlab(p_name)
return(p1)
} #
p1<-Plot1to1_new(s.wide,"Diver_AdColDen","SfM_AdColDen","SfM Adult Density","Diver Adult Density")
p1
p2<-ggplot(subset(site,GENUS_CODE=="SSSS"), aes(x=METHOD, y=AdColDen, fill=METHOD)) +
geom_boxplot() +
geom_label(label="NS", x=1.5,y=29,label.size = 0.35,color = "black", fill="white")+
theme_bw() +
theme(
axis.text.x = element_text(angle = 0)
,plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank()
,axis.ticks.x = element_blank() # no x axis ticks
,axis.title.x = element_text( vjust = -.0001)
,legend.position="none")+ # adjust x axis to lower the same amount as the genus labels
labs(x="Method",y="Mean Adult Density/m2")
p2
p3<-ggplot(subset(site,GENUS_CODE=="SSSS"), aes(x=HAB_R1, y=AdColDen, fill=METHOD)) +
geom_boxplot() +
# guides(fill=FALSE)
theme_bw() +
geom_label(label="Method x Habitat NS", x=3.5,y=29,label.size = 0.35,color = "black", fill="white")+
theme(
axis.text.x = element_text(angle = 90)
,plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank()
,axis.ticks.x = element_blank() # no x axis ticks
,axis.title.x = element_text( vjust = -.0001) # adjust x axis to lower the same amount as the genus labels
,legend.position="none")+
labs(x="Habitat Type",y="Mean Adult Density/m2")
p3
#https://aosmith.rbind.io/2018/11/16/plot-fitted-lines/
library(nlme)
mod<-lme(sqAdColDen~METHOD*MAX_DEPTH_M, random = ~1|SEC_NAME,data=s)
newdat.lme = data.frame(METHOD = s$METHOD,
MAX_DEPTH_M = rep(seq(0,30,by=0.29),2),
SEC_NAME = s$SEC_NAME)
head(newdat.lme)
newdat.lme$predlme <- predict(mod, newdata = newdat.lme, level=0)
newdat.lme$AdColDen<-newdat.lme$predlme^2 #back transform predicted values
des = model.matrix(formula(mod)[-2], newdat.lme)
predvar = diag( des %*% vcov(mod) %*% t(des) )
newdat.lme$lower = with(newdat.lme, predlme - 2*sqrt(predvar) )
newdat.lme$upper = with(newdat.lme, predlme + 2*sqrt(predvar) )
newdat.lme$lower<-newdat.lme$lower^2 #back transform predicted values
newdat.lme$upper<-newdat.lme$upper^2 #back transform predicted values
p4<-ggplot(s, aes(x = MAX_DEPTH_M, y = AdColDen, color = METHOD) ) +
geom_point(aes(colour = factor(METHOD))) +
geom_line(data = newdat.lme, aes(y = AdColDen), size = 1)+
geom_ribbon(data = newdat.lme, aes(y = NULL, ymin = lower, ymax = upper,
color = NULL, fill = METHOD),alpha = .15)+
geom_label(label="Method x Depth NS", x=15,y=29,label.size = 0.35,color = "black", fill="white")+
theme_bw() +
theme(
axis.text.x = element_text(angle = 0)
,plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank()
,axis.ticks.x = element_blank() # no x axis ticks
,axis.title.x = element_text( vjust = -.0001) # adjust x axis to lower the same amount as the genus labels
,legend.position="none")+
labs(x="Max Depth (m)",y="Adult Density/m2")
p4
AdColDenS<-grid.arrange(p1,p2,p3,p4,nrow=1,ncol=4)
ggsave(plot<-AdColDenS,file="T:/Benthic/Data/SfM/Method Comparision/Figures/AdColDenSSSS_stats.pdf",width=10,height=5)
Plot1to1_new<-function(d,response_variable,predictor_variable,r_name,p_name){
#sub<-d[d$taxon,]
d$Y<-d[,response_variable]
d$X<-d[,predictor_variable]
mx_val<-max(d$Y, d$X, na.rm = TRUE)
corr<-cor.test(d$X, d$Y, method="pearson")
rmse<-rmse(d$Y, d$X,na.rm=TRUE)
r_text<-paste("RMSE = ", round(rmse,digits = 2),"\n r = ", round((corr$estimate),2), sep="")
p1<-ggplot(d, aes(x=X, y=Y)) +
geom_point(size=1) + 	geom_abline(slope=1, intercept=0) +
geom_smooth(method="lm", color="red", linetype="dashed", se=F) +
geom_label(aes((mx_val/5), (mx_val * 0.9), label=r_text), nudge_y=-0.1, nudge_x=0.2,label.size=0.35, color="black", fill="white") +
theme_bw()+
scale_x_continuous(limits=c(0,mx_val)) +
scale_y_continuous(limits=c(0,mx_val)) +
ylab(r_name) +  xlab(p_name)
return(p1)
} #
p1<-Plot1to1_new(s.wide,"Diver_AdColDen","SfM_AdColDen","SfM Adult Density","Diver Adult Density")
p1
p2<-ggplot(subset(site,GENUS_CODE=="SSSS"), aes(x=METHOD, y=AdColDen, fill=METHOD)) +
geom_boxplot() +
geom_label(label="NS", x=1.5,y=29,label.size = 0.35,color = "black", fill="white")+
theme_bw() +
theme(
axis.text.x = element_text(angle = 0)
,plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank()
,axis.ticks.x = element_blank() # no x axis ticks
,axis.title.x = element_text( vjust = -.0001)
,legend.position="none")+ # adjust x axis to lower the same amount as the genus labels
labs(x="Method",y="Mean Adult Density/m2")
p2
p3<-ggplot(subset(site,GENUS_CODE=="SSSS"), aes(x=HAB_R1, y=AdColDen, fill=METHOD)) +
geom_boxplot() +
# guides(fill=FALSE)
theme_bw() +
geom_label(label="Method x Habitat NS", x=3.5,y=29,label.size = 0.35,color = "black", fill="white")+
theme(
axis.text.x = element_text(angle = 90)
,plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank()
,axis.ticks.x = element_blank() # no x axis ticks
,axis.title.x = element_text( vjust = -.0001) # adjust x axis to lower the same amount as the genus labels
,legend.position="none")+
labs(x="Habitat Type",y="Mean Adult Density/m2")
p3
#https://aosmith.rbind.io/2018/11/16/plot-fitted-lines/
library(nlme)
mod<-lme(sqAdColDen~METHOD*MAX_DEPTH_M, random = ~1|SEC_NAME,data=s)
newdat.lme = data.frame(METHOD = s$METHOD,
MAX_DEPTH_M = rep(seq(0,30,by=0.29),2),
SEC_NAME = s$SEC_NAME)
head(newdat.lme)
newdat.lme$predlme <- predict(mod, newdata = newdat.lme, level=0)
newdat.lme$AdColDen<-newdat.lme$predlme^2 #back transform predicted values
des = model.matrix(formula(mod)[-2], newdat.lme)
predvar = diag( des %*% vcov(mod) %*% t(des) )
newdat.lme$lower = with(newdat.lme, predlme - 2*sqrt(predvar) )
newdat.lme$upper = with(newdat.lme, predlme + 2*sqrt(predvar) )
newdat.lme$lower<-newdat.lme$lower^2 #back transform predicted values
newdat.lme$upper<-newdat.lme$upper^2 #back transform predicted values
p4<-ggplot(s, aes(x = MAX_DEPTH_M, y = AdColDen, color = METHOD) ) +
geom_point(aes(colour = factor(METHOD))) +
geom_line(data = newdat.lme, aes(y = AdColDen), size = 1)+
geom_ribbon(data = newdat.lme, aes(y = NULL, ymin = lower, ymax = upper,
color = NULL, fill = METHOD),alpha = .15)+
geom_label(label="Method x Depth NS", x=18,y=29,label.size = 0.35,color = "black", fill="white")+
theme_bw() +
theme(
axis.text.x = element_text(angle = 0)
,plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank()
,axis.ticks.x = element_blank() # no x axis ticks
,axis.title.x = element_text( vjust = -.0001) # adjust x axis to lower the same amount as the genus labels
,legend.position="none")+
labs(x="Max Depth (m)",y="Adult Density/m2")
p4
AdColDenS<-grid.arrange(p1,p2,p3,p4,nrow=1,ncol=4)
ggsave(plot<-AdColDenS,file="T:/Benthic/Data/SfM/Method Comparision/Figures/AdColDenSSSS_stats.pdf",width=10,height=5)
ggplot(subset(site,GENUS_CODE=="SSSS"), aes(x=METHOD, y=AdColDen, fill=METHOD)) +
geom_boxplot() +
#geom_label(label="NS", x=1.5,y=29,label.size = 0.35,color = "black", fill="white")+
geom_label(label="NS", nudge_y=-0.1, nudge_x=0.2,label.size=0.35, color="black", fill="white") +
theme_bw() +
theme(
axis.text.x = element_text(angle = 0)
,plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank()
,axis.ticks.x = element_blank() # no x axis ticks
,axis.title.x = element_text( vjust = -.0001)
,legend.position="none")+ # adjust x axis to lower the same amount as the genus labels
labs(x="Method",y="Mean Adult Density/m2")
ggplot(subset(site,GENUS_CODE=="SSSS"), aes(x=METHOD, y=AdColDen, fill=METHOD)) +
geom_boxplot() +
#geom_label(label="NS", x=1.5,y=29,label.size = 0.35,color = "black", fill="white")+
geom_label(label="NS",label.size=0.35, color="black", fill="white") +
theme_bw()
PlotMethod<-function(d,grouping_field,metric_field,genus_field,metric_name,x,y,siglabel){
d$GROUP<-d[,grouping_field]
d$METRIC<-d[,metric_field]
s<-subset(d,GROUP==genus_field)
p2<-ggplot(s, aes(x=METHOD, y=METRIC, fill=METHOD)) +
geom_boxplot() +
geom_label(label=siglabel, x=x,y=y,label.size = 0.35,color = "black", fill="white")+
theme_bw() +
theme(
axis.text.x = element_text(angle = 0)
,plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank()
,axis.ticks.x = element_blank() # no x axis ticks
,axis.title.x = element_text( vjust = -.0001)
,legend.position="none")+ # adjust x axis to lower the same amount as the genus labels
labs(x="Method",y=metric_name)
return(p2)
}
p2<-PlotMethod(site,"GENUS_CODE","AdColDen","SSSS","Mean Adult Density",1.5,29,"NS")
p2
PlotHabitat<-function(d,grouping_field,metric_field,genus_field,metric_name,x,y,siglabel){
d$GROUP<-d[,grouping_field]
d$METRIC<-d[,metric_field]
s<-subset(d,GROUP==genus_field)
p<-ggplot(s, aes(x=HAB_R1, y=METRIC, fill=METHOD)) +
geom_boxplot() +
theme_bw() +
geom_label(label=siglabel, x=x,y=y,label.size = 0.35,color = "black", fill="white")+
theme(
axis.text.x = element_text(angle = 90)
,plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank()
,axis.ticks.x = element_blank() # no x axis ticks
,axis.title.x = element_text( vjust = -.0001) # adjust x axis to lower the same amount as the genus labels
,legend.position="none")+
labs(x="Habitat Type",y=metric_name)
return(p)
}
p3<-PlotHabitat(site,"GENUS_CODE","AdColDen","SSSS","Mean Adult Density",3.5,29,"Method x Habitat NS")
p3
PlotDepth<-function(d,grouping_field,metric_field,genus_field,metric_name,x,y,siglabel){
d$GROUP<-d[,grouping_field]
d$METRIC<-d[,metric_field]
s<-subset(d,GROUP==genus_field)
p<-ggplot(s, aes(x = MAX_DEPTH_M, y = METRIC, color = METHOD) ) +
geom_point(aes(colour = factor(METHOD))) +
geom_line(data = newdat.lme, aes(y = METRIC), size = 1)+
geom_ribbon(data = newdat.lme, aes(y = NULL, ymin = lower, ymax = upper,
color = NULL, fill = METHOD),alpha = .15)+
geom_label(label=siglabel, x=x,y=y,label.size = 0.35,color = "black", fill="white")+
theme_bw() +
theme(
axis.text.x = element_text(angle = 0)
,plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank()
,axis.ticks.x = element_blank() # no x axis ticks
,axis.title.x = element_text( vjust = -.0001) # adjust x axis to lower the same amount as the genus labels
,legend.position="none")+
labs(x="Max Depth (m)",y=metric_name)
return(p)
}
p4<-PlotDepth(site,"GENUS_CODE","AdColDen","SSSS","Adult Density",18,29,"Method x Depth NS")
p4
PlotDepth<-function(d,grouping_field,metric_field,metric_field2,genus_field,metric_name,x,y,siglabel){
d$GROUP<-d[,grouping_field]
d$METRIC<-d[,metric_field]
newdat.lme$METRIC2<-newdat.lme[,metric_field2]
s<-subset(d,GROUP==genus_field)
p<-ggplot(s, aes(x = MAX_DEPTH_M, y = METRIC, color = METHOD) ) +
geom_point(aes(colour = factor(METHOD))) +
geom_line(data = newdat.lme, aes(y = METRIC2), size = 1)+
geom_ribbon(data = newdat.lme, aes(y = NULL, ymin = lower, ymax = upper,
color = NULL, fill = METHOD),alpha = .15)+
geom_label(label=siglabel, x=x,y=y,label.size = 0.35,color = "black", fill="white")+
theme_bw() +
theme(
axis.text.x = element_text(angle = 0)
,plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank()
,axis.ticks.x = element_blank() # no x axis ticks
,axis.title.x = element_text( vjust = -.0001) # adjust x axis to lower the same amount as the genus labels
,legend.position="none")+
labs(x="Max Depth (m)",y=metric_name)
return(p)
}
p4<-PlotDepth(site,"GENUS_CODE","AdColDen","AdColDen","SSSS","Adult Density",18,29,"Method x Depth NS")
p4
s<-subset(site,GENUS_CODE=="SSSS")
hist(log(s$JuvColDen))
hist(sqrt(s$JuvColDen))
s$sqJuvColDen<-sqrt(s$JuvColDen)
m<-lmer(sqJuvColDen~METHOD + (1|SEC_NAME),data=s)
par(mfrow=c(2,2)) # make the subplots
qqnorm(resid(m))
E2<-resid(m, type = "response") # extract normalized residuals
F2<-fitted(m) # extract the fitted data
plot(F2, E2, xlab = "fitted values", ylab = "residuals") # plot the relationship
abline(h = 0, lty = 2) # add a flat line at zerp
# test for homogeneity of variances
boxplot(E2~s$SEC_NAME, ylab = "residuals")
# check for independence. There should be no pattern
plot(E2~s$METHOD, ylab = 'residuals', xlab = "METHOD")
par(mfrow=c(2,2)) # make the subplots
qqnorm(resid(m))
E2<-resid(m, type = "response") # extract normalized residuals
F2<-fitted(m) # extract the fitted data
plot(F2, E2, xlab = "fitted values", ylab = "residuals") # plot the relationship
abline(h = 0, lty = 2) # add a flat line at zerp
# test for homogeneity of variances
boxplot(E2~s$SEC_NAME, ylab = "residuals")
# check for independence. There should be no pattern
plot(E2~s$METHOD, ylab = 'residuals', xlab = "METHOD")
s$logJuvColDen<-sqrt(log$JuvColDen)
s$logJuvColDen<-log(s$JuvColDen)
m<-lmer(logJuvColDen~METHOD + (1|SEC_NAME),data=s)
par(mfrow=c(2,2)) # make the subplots
qqnorm(resid(m))
E2<-resid(m, type = "response") # extract normalized residuals
F2<-fitted(m) # extract the fitted data
plot(F2, E2, xlab = "fitted values", ylab = "residuals") # plot the relationship
abline(h = 0, lty = 2) # add a flat line at zerp
# test for homogeneity of variances
boxplot(E2~s$SEC_NAME, ylab = "residuals")
# check for independence. There should be no pattern
plot(E2~s$METHOD, ylab = 'residuals', xlab = "METHOD")
s$logJuvColDen<-log(s$JuvColDen)
m<-lmer(logJuvColDen~METHOD + (1|SEC_NAME),data=s)
s$logJuvColDen<-log(s$JuvColDen+1)
m<-lmer(logJuvColDen~METHOD + (1|SEC_NAME),data=s)
par(mfrow=c(2,2)) # make the subplots
qqnorm(resid(m))
E2<-resid(m, type = "response") # extract normalized residuals
F2<-fitted(m) # extract the fitted data
plot(F2, E2, xlab = "fitted values", ylab = "residuals") # plot the relationship
abline(h = 0, lty = 2) # add a flat line at zerp
# test for homogeneity of variances
boxplot(E2~s$SEC_NAME, ylab = "residuals")
# check for independence. There should be no pattern
plot(E2~s$METHOD, ylab = 'residuals', xlab = "METHOD")
m<-glmer(JuvColDen~METHOD + (1|SEC_NAME),family="Gamma",data=s)
m<-glmer((JuvColDen+1)~METHOD + (1|SEC_NAME),family="Gamma",data=s)
par(mfrow=c(2,2)) # make the subplots
qqnorm(resid(m))
E2<-resid(m, type = "response") # extract normalized residuals
F2<-fitted(m) # extract the fitted data
plot(F2, E2, xlab = "fitted values", ylab = "residuals") # plot the relationship
abline(h = 0, lty = 2) # add a flat line at zerp
# test for homogeneity of variances
boxplot(E2~s$SEC_NAME, ylab = "residuals")
# check for independence. There should be no pattern
plot(E2~s$METHOD, ylab = 'residuals', xlab = "METHOD")
m<-glmer(JuvColCount~METHOD + (1|SEC_NAME),family="poisson",data=s)
par(mfrow=c(2,2)) # make the subplots
qqnorm(resid(m))
E2<-resid(m, type = "response") # extract normalized residuals
F2<-fitted(m) # extract the fitted data
plot(F2, E2, xlab = "fitted values", ylab = "residuals") # plot the relationship
abline(h = 0, lty = 2) # add a flat line at zerp
# test for homogeneity of variances
boxplot(E2~s$SEC_NAME, ylab = "residuals")
# check for independence. There should be no pattern
plot(E2~s$METHOD, ylab = 'residuals', xlab = "METHOD")
m<-lmer(logJuvColDen~METHOD + (1|SEC_NAME),data=s)
par(mfrow=c(2,2)) # make the subplots
qqnorm(resid(m))
E2<-resid(m, type = "response") # extract normalized residuals
F2<-fitted(m) # extract the fitted data
plot(F2, E2, xlab = "fitted values", ylab = "residuals") # plot the relationship
abline(h = 0, lty = 2) # add a flat line at zerp
# test for homogeneity of variances
boxplot(E2~s$SEC_NAME, ylab = "residuals")
# check for independence. There should be no pattern
plot(E2~s$METHOD, ylab = 'residuals', xlab = "METHOD")
s$sqJuvColDen<-sqrt(s$JuvColDen)
m<-lmer(sqJuvColDen~METHOD + (1|SEC_NAME),data=s)
par(mfrow=c(2,2)) # make the subplots
qqnorm(resid(m))
E2<-resid(m, type = "response") # extract normalized residuals
F2<-fitted(m) # extract the fitted data
plot(F2, E2, xlab = "fitted values", ylab = "residuals") # plot the relationship
abline(h = 0, lty = 2) # add a flat line at zerp
# test for homogeneity of variances
boxplot(E2~s$SEC_NAME, ylab = "residuals")
# check for independence. There should be no pattern
plot(E2~s$METHOD, ylab = 'residuals', xlab = "METHOD")
m<-glmmTMB(JuvColCount~METHOD + (1|SEC_NAME),ziformula=~1,
family=poisson,data=s)
par(mfrow=c(2,2)) # make the subplots
qqnorm(resid(m))
E2<-resid(m, type = "response") # extract normalized residuals
F2<-fitted(m) # extract the fitted data
plot(F2, E2, xlab = "fitted values", ylab = "residuals") # plot the relationship
abline(h = 0, lty = 2) # add a flat line at zerp
# test for homogeneity of variances
boxplot(E2~s$SEC_NAME, ylab = "residuals")
# check for independence. There should be no pattern
plot(E2~s$METHOD, ylab = 'residuals', xlab = "METHOD")
DPlots<-function(m,s){
par(mfrow=c(2,2)) # make the subplots
qqnorm(resid(m))
E2<-resid(m, type = "response") # extract normalized residuals
F2<-fitted(m) # extract the fitted data
plot(F2, E2, xlab = "fitted values", ylab = "residuals") # plot the relationship
abline(h = 0, lty = 2) # add a flat line at zerp
# test for homogeneity of variances
boxplot(E2~s$SEC_NAME, ylab = "residuals")
# check for independence. There should be no pattern
plot(E2~s$METHOD, ylab = 'residuals', xlab = "METHOD")
}
DPlots(m,s)
s<-subset(site,GENUS_CODE=="SSSS")
hist(log(s$AdColDen))
s$sqAdColDen<-sqrt(s$AdColDen)
m<-lmer(sqAdColDen~METHOD + (1|SEC_NAME),data=s)
DPlots(m,s)
s<-subset(site,GENUS_CODE=="SSSS")
hist(sqrt(s$JuvColDen))
s$sqJuvColDen<-sqrt(s$JuvColDen)
m<-lmer(sqJuvColDen~METHOD + (1|SEC_NAME),data=s)
DPlots(m,s)
mod1<-lmer(sqJuvColDen~1 + (1|SEC_NAME),data=s)
mod2<-lmer(sqJuvColDen~METHOD + (1|SEC_NAME),data=s)
mod3<-lmer(sqJuvColDen~MAX_DEPTH_M + (1|SEC_NAME),data=s)
mod4<-lmer(sqJuvColDen~HAB_R1 + (1|SEC_NAME),data=s)
mod5<-lmer(sqJuvColDen~METHOD*MAX_DEPTH_M + (1|SEC_NAME),data=s)
mod6<-lmer(sqJuvColDen~METHOD*HAB_R1 + (1|SEC_NAME),data=s)
#mod7<-lmer(sqAdColDen~METHOD*HAB_R1*MAX_DEPTH_M + (1|SEC_NAME),data=s)
anova(mod6,mod5,test="Chisq")
anova(mod6,mod4,test="Chisq")
anova(mod5,mod4,test="Chisq")
anova(mod4,mod3,test="Chisq")
anova(mod4,mod3,test="Chisq")
anova(mod6,mod2,test="Chisq")
anova(mod5,mod2,test="Chisq")
anova(mod5,mod3,test="Chisq")
mod<-lme(sqJuvColDen~METHOD*MAX_DEPTH_M, random = ~1|SEC_NAME,data=s)
newdat.lme = data.frame(METHOD = s$METHOD,
MAX_DEPTH_M = rep(seq(0,30,by=0.29),2),
SEC_NAME = s$SEC_NAME)
head(newdat.lme)
newdat.lme$predlme <- predict(mod, newdata = newdat.lme, level=0)
newdat.lme$JuvColDen<-newdat.lme$predlme^2 #back transform predicted values
des = model.matrix(formula(mod)[-2], newdat.lme)
predvar = diag( des %*% vcov(mod) %*% t(des) )
newdat.lme$lower = with(newdat.lme, predlme - 2*sqrt(predvar) )
newdat.lme$upper = with(newdat.lme, predlme + 2*sqrt(predvar) )
newdat.lme$lower<-newdat.lme$lower^2 #back transform predicted values
newdat.lme$upper<-newdat.lme$upper^2 #back transform predicted values
p1<-Plot1to1_new(s.wide,"Diver_JuvColDen","SfM_JuvColDen","SfM Juvenile Density","Diver Juvenile Density")
p2<-PlotMethod(site,"GENUS_CODE","JuvColDen","SSSS","Mean Juvenile Density",1.5,29,"NS")
p3<-PlotHabitat(site,"GENUS_CODE","JuvColDen","SSSS","Mean Juvenile Density",3.5,29,"Method x Habitat NS")
p4<-PlotDepth(site,"GENUS_CODE","JuvColDen","JuvColDen","SSSS","Juvenile Density",18,29,"Method x Depth NS")
JuvColDenS<-grid.arrange(p1,p2,p3,p4,nrow=1,ncol=4)
ggsave(plot<-JuvColDenS,file="T:/Benthic/Data/SfM/Method Comparision/Figures/JuvColDenSSSS_stats.pdf",width=10,height=5)
anova(mod2,mod1,test="Chisq")
Plot1to1_new<-function(d,response_variable,predictor_variable,r_name,p_name){
#sub<-d[d$taxon,]
d$Y<-d[,response_variable]
d$X<-d[,predictor_variable]
mx_val<-max(d$Y, d$X, na.rm = TRUE)
corr<-cor.test(d$X, d$Y, method="pearson")
rmse<-rmse(d$Y, d$X,na.rm=TRUE)
r_text<-paste("RMSE = ", round(rmse,digits = 2),"\n r = ", round((corr$estimate),2), sep="")
p1<-ggplot(d, aes(x=X, y=Y)) +
geom_point(size=1) + 	geom_abline(slope=1, intercept=0) +
geom_smooth(method="lm", color="red", linetype="dashed", se=F) +
geom_label(aes((mx_val/5), (mx_val * 0.9), label=r_text), nudge_y=-0.1, nudge_x=0.3,label.size=0.35, color="black", fill="white") +
theme_bw()+
scale_x_continuous(limits=c(0,mx_val)) +
scale_y_continuous(limits=c(0,mx_val)) +
ylab(r_name) +  xlab(p_name)
return(p1)
} #
p1<-Plot1to1_new(s.wide,"Diver_JuvColDen","SfM_JuvColDen","SfM Juvenile Density","Diver Juvenile Density")
p1<-Plot1to1_new(s.wide,"Diver_JuvColDen","SfM_JuvColDen","SfM Juvenile Density","Diver Juvenile Density")
p2<-PlotMethod(site,"GENUS_CODE","JuvColDen","SSSS","Mean Juvenile Density",1.5,60,"NS")
p3<-PlotHabitat(site,"GENUS_CODE","JuvColDen","SSSS","Mean Juvenile Density",3.5,60,"Method x Habitat NS")
p4<-PlotDepth(site,"GENUS_CODE","JuvColDen","JuvColDen","SSSS","Juvenile Density",18,60,"Significant Method x Depth")
JuvColDenS<-grid.arrange(p1,p2,p3,p4,nrow=1,ncol=4)
ggsave(plot<-JuvColDenS,file="T:/Benthic/Data/SfM/Method Comparision/Figures/JuvColDenSSSS_stats.pdf",width=10,height=5)
Plot1to1_new<-function(d,response_variable,predictor_variable,r_name,p_name){
#sub<-d[d$taxon,]
d$Y<-d[,response_variable]
d$X<-d[,predictor_variable]
mx_val<-max(d$Y, d$X, na.rm = TRUE)
corr<-cor.test(d$X, d$Y, method="pearson")
rmse<-rmse(d$Y, d$X,na.rm=TRUE)
r_text<-paste("RMSE = ", round(rmse,digits = 2),"\n r = ", round((corr$estimate),2), sep="")
p1<-ggplot(d, aes(x=X, y=Y)) +
geom_point(size=1) + 	geom_abline(slope=1, intercept=0) +
geom_smooth(method="lm", color="red", linetype="dashed", se=F) +
geom_label(aes((mx_val/5), (mx_val * 0.9), label=r_text), nudge_y=-0.1, nudge_x=1,label.size=0.35, color="black", fill="white") +
theme_bw()+
scale_x_continuous(limits=c(0,mx_val)) +
scale_y_continuous(limits=c(0,mx_val)) +
ylab(r_name) +  xlab(p_name)
return(p1)
} #
p1<-Plot1to1_new(s.wide,"Diver_JuvColDen","SfM_JuvColDen","SfM Juvenile Density","Diver Juvenile Density")
p1<-Plot1to1_new(s.wide,"Diver_JuvColDen","SfM_JuvColDen","SfM Juvenile Density","Diver Juvenile Density")
p2<-PlotMethod(site,"GENUS_CODE","JuvColDen","SSSS","Mean Juvenile Density",1.5,60,"NS")
p3<-PlotHabitat(site,"GENUS_CODE","JuvColDen","SSSS","Mean Juvenile Density",3.5,60,"Method x Habitat NS")
p4<-PlotDepth(site,"GENUS_CODE","JuvColDen","JuvColDen","SSSS","Juvenile Density",18,60,"Significant Method x Depth")
JuvColDenS<-grid.arrange(p1,p2,p3,p4,nrow=1,ncol=4)
ggsave(plot<-JuvColDenS,file="T:/Benthic/Data/SfM/Method Comparision/Figures/JuvColDenSSSS_stats.pdf",width=10,height=5)
