,legend.position="bottom"
,legend.title = element_blank())+
labs(x="Method",y="Mean Adult Density/m2")
p1
p1<-ggplot(subset(site,GENUS_CODE=="SSSS"), aes(x=METHOD, y=AdColDen, fill=METHOD)) +
geom_boxplot() +
geom_label(label="NS", x=1.5,y=28,label.size = 0.35,color = "black", fill="white")+
theme_bw() +
theme(
axis.text.x = element_text(angle = 90)
,plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank()
,axis.ticks.x = element_blank() # no x axis ticks
,axis.title.x = element_text( vjust = -.0001) # adjust x axis to lower the same amount as the genus labels
,legend.position="bottom"
,legend.title = element_blank())+
labs(x="Method",y="Mean Adult Density/m2")
p1
dev.off()
ggplot(subset(site,GENUS_CODE=="SSSS"), aes(x=METHOD, y=AdColDen, fill=METHOD)) +
geom_boxplot() +
geom_label(label="NS", x=1.5,y=28,label.size = 0.35,color = "black", fill="white")+
theme_bw() +
theme(
axis.text.x = element_text(angle = 90)
,plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank()
,axis.ticks.x = element_blank() # no x axis ticks
,axis.title.x = element_text( vjust = -.0001) # adjust x axis to lower the same amount as the genus labels
,legend.position="bottom"
,legend.title = element_blank())+
labs(x="Method",y="Mean Adult Density/m2")
ggplot(subset(site,GENUS_CODE=="SSSS"), aes(x=METHOD, y=AdColDen, fill=METHOD)) +
geom_boxplot() +
geom_label(label="NS", x=1.5,y=28,label.size = 0.35,color = "black", fill="white")+
theme_bw() +
theme(
axis.text.x = element_text(angle = 0)
,plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank()
,axis.ticks.x = element_blank() # no x axis ticks
,axis.title.x = element_text( vjust = -.0001) # adjust x axis to lower the same amount as the genus labels
,legend.position="bottom"
,legend.title = element_blank())+
labs(x="Method",y="Mean Adult Density/m2")
mod<-lmer(sqAdColDen~METHOD*MAX_DEPTH_M + (1|SEC_NAME),data=s)
newdat.lme = data.frame(grp = s$METHOD,
Depth = s$MAX_DEPTH_M)
head(newdat.lme)
newdat.lme$predlme <- predict(mod, newdata = newdat.lme, level = 0)
mod<-lmer(sqAdColDen~METHOD*MAX_DEPTH_M + (1|SEC_NAME),data=s)
newdat.lme = data.frame(Method = s$METHOD,
Depth = s$MAX_DEPTH_M)
head(newdat.lme)
newdat.lme$predlme <- predict(mod, newdata = newdat.lme, level = 0)
mod<-lmer(sqAdColDen~METHOD*MAX_DEPTH_M + (1|SEC_NAME),data=s)
newdat.lme = data.frame(METHOD = s$METHOD,
MAX_DEPTH_M = s$MAX_DEPTH_M)
head(newdat.lme)
newdat.lme$predlme <- predict(mod, newdata = newdat.lme, level = 0)
library(nlme)
mod<-lme(sqAdColDen~METHOD*MAX_DEPTH_M + random = ~1|SEC_NAME,data=s)
newdat.lme = data.frame(METHOD = s$METHOD,
MAX_DEPTH_M = s$MAX_DEPTH_M)
head(newdat.lme)
newdat.lme$predlme <- predict(mod, newdata = newdat.lme, level = 0)
?predict.lme
mod<-lme(sqAdColDen~METHOD*MAX_DEPTH_M + random = ~1|SEC_NAME,data=s)
newdat.lme = data.frame(METHOD = s$METHOD,
MAX_DEPTH_M = s$MAX_DEPTH_M,
SEC_NAME = s$SEC_NAME)
head(newdat.lme)
newdat.lme$predlme <- predict(mod, newdata = newdat.lme, level = 0)
ggplot(s, aes(x = MAX_DEPTH_M, y = sqAdColDen, color = METHOD) ) +
geom_point(aes(colour = factor(METHOD))) +
geom_line(data = newdat.lme, aes(y = predlme), size = 1)
head(newdat.lme)
head(s)
install.packages("ggeffects")
mod<-lmer(sqAdColDen~METHOD*MAX_DEPTH_M + (1|SEC_NAME),data=s)
library(lme4)
METHOD
METHOD
head(s)
mod<-lmer(sqAdColDen~METHOD*MAX_DEPTH_M + (1|SEC_NAME),data=s)
library(ggeffects)
pred <- ggpredict(mod, c("MAX_DEPTH_M", "METHOD"))
pred
plot(pred)
plot(pred,add.data = T)
mod<-glmer((AdColCount+1)~METHOD*MAX_DEPTH_M + (1|SEC_NAME),family="Gamma",data=s)
pred <- ggpredict(mod, c("MAX_DEPTH_M", "METHOD"))
plot(pred,add.data = T)
s$AdColCount<-s$AdColCount+0.001
mod<-glmer(AdColCount~METHOD*MAX_DEPTH_M + (1|SEC_NAME),family="Gamma",data=s)
mod<-glmer(AdColCount~METHOD*MAX_DEPTH_M + (1|SEC_NAME),family="Gamma",data=s)
pred <- ggpredict(mod, c("MAX_DEPTH_M", "METHOD"))
plot(pred,add.data = T)
mod<-lmer(sqAdColDen~METHOD*MAX_DEPTH_M + (1|SEC_NAME),data=s)
pred <- ggpredict(mod, c("MAX_DEPTH_M", "METHOD"))
plot(pred,add.data = T)
s$AdColDen<-s$AdColDen+0.001
mod<-glmer(AdColDen~METHOD*MAX_DEPTH_M + (1|SEC_NAME),family="Gamma",data=s)
pred <- ggpredict(mod, c("MAX_DEPTH_M", "METHOD"))
plot(pred,add.data = T)
m3<-glmer((METRIC+1)~METHOD*MAX_DEPTH_M + (1|SEC_NAME),family=Gamma(link = log),data=s,control=glmerControl(optimizer="bobyqa",optCtrl=list(maxfun=200000)))
mod<-glmer(AdColDen~METHOD*MAX_DEPTH_M + (1|SEC_NAME),family=Gamma(link = log),data=s,control=glmerControl(optimizer="bobyqa",optCtrl=list(maxfun=200000)))
mod<-glmer(AdColDen~METHOD*MAX_DEPTH_M + (1|SEC_NAME),family=Gamma(link = log),data=s,control=glmerControl(optimizer="Nelder_Mead",optCtrl=list(maxfun=200000)))
pred <- ggpredict(mod, c("MAX_DEPTH_M", "METHOD"))
plot(pred,add.data = T)
ggplot(pred, aes(x = MAX_DEPTH_M, y = AdColDen, color = METHOD) ) +
geom_point(aes(colour = factor(METHOD))) +
geom_line(size = 1)
library(ggplot2)
ggplot(pred, aes(x = MAX_DEPTH_M, y = AdColDen, color = METHOD) ) +
geom_point(aes(colour = factor(METHOD))) +
geom_line(size = 1)
pred
ggplot(pred, aes(x = MAX_DEPTH_M, y = AdColDen, color = METHOD) ) +
geom_point() +
geom_line(size = 1)
ggplot(pred, aes(x = x, y = AdColDen, color = METHOD) ) +
geom_point() +
geom_line(size = 1)
#geom_point() +
geom_line(size = 1)
ggplot(pred, aes(x = x, y = Predicted, color = METHOD) ) +
#geom_point() +
geom_line(size = 1)
pred
ggplot(pred, aes(x = x, y = Predicted, color = METHOD) ) +
#geom_point() +
geom_line(size = 1)
pred <- ggpredict(mod, terms=c("MAX_DEPTH_M", "METHOD"))
plot(pred,add.data = T,show.title = FALSE)
plot(pred,add.data = T,show.title = FALSE,use.theme = FALSE)
plot(pred,add.data = T,show.title = FALSE,use.theme = FALSE,
plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank())
plot(pred,add.data = T,show.title = FALSE,use.theme = FALSE,grid = FALSE)
plot(pred,add.data = T,show.title = FALSE,
use.theme = FALSE,grid = FALSE)
plot(pred,add.data = T,show.title = FALSE,
use.theme = TRUE,grid = FALSE)
newdat.lme
30/208
newdat.lme = data.frame(METHOD = s$METHOD,
MAX_DEPTH_M = seq(0,30, by=0.1442)
SEC_NAME = s$SEC_NAME)
newdat.lme = data.frame(METHOD = s$METHOD,
MAX_DEPTH_M = seq(0,30, by=0.1442),
SEC_NAME = s$SEC_NAME)
newdat.lme = data.frame(METHOD = s$METHOD,
MAX_DEPTH_M = seq(0,30, by=0.1442308),
SEC_NAME = s$SEC_NAME)
library(nlme)
mod<-lme(AdColDen~METHOD*MAX_DEPTH_M + random= ~1|SEC_NAME,family=Gamma(link = log),data=s,control=glmerControl(optimizer="Nelder_Mead",optCtrl=list(maxfun=200000)))
mod<-lme(AdColDen~METHOD*MAX_DEPTH_M + random = ~1|SEC_NAME,family=Gamma(link = log),data=s,control=glmerControl(optimizer="Nelder_Mead",optCtrl=list(maxfun=200000)))
mod<-lme(sqAdColDen~METHOD*MAX_DEPTH_M + random = ~1|SEC_NAME,data=s)
mod<-lme(AdColDen~METHOD*MAX_DEPTH_M, random = ~1|SEC_NAME,family=Gamma(link = log),data=s,control=glmerControl(optimizer="Nelder_Mead",optCtrl=list(maxfun=200000)))
mod<-glmer(AdColDen~METHOD*MAX_DEPTH_M + (1|SEC_NAME),family=Gamma(link = log),data=s,control=glmerControl(optimizer="Nelder_Mead",optCtrl=list(maxfun=200000)))
newdat.lme = data.frame(METHOD = s$METHOD,
MAX_DEPTH_M = seq(0,30, by=0.1442308),
SEC_NAME = s$SEC_NAME)
head(newdat.lme)
newdat.lme$predlme <- predict(mod, newdata = newdat.lme, re.form = NA)
ggplot(s, aes(x = MAX_DEPTH_M, y = sqAdColDen, color = METHOD) ) +
geom_point(aes(colour = factor(METHOD))) +
geom_line(data = newdat.lme, aes(y = predlme), size = 1)
30/104
newdat.lme = data.frame(METHOD = s$METHOD,
MAX_DEPTH_M = c(seq(0,30,by=0.2884615),rep=2),
SEC_NAME = s$SEC_NAME)
newdat.lme = data.frame(METHOD = s$METHOD,
MAX_DEPTH_M = rep(seq(0,30,by=0.2884615),2),
SEC_NAME = s$SEC_NAME)
208/2
30/104
newdat.lme = data.frame(METHOD = s$METHOD,
MAX_DEPTH_M = rep(seq(0,30,by=0.2883),2),
SEC_NAME = s$SEC_NAME)
newdat.lme = data.frame(METHOD = s$METHOD,
MAX_DEPTH_M = rep(seq(0,30,by=0.287),2),
SEC_NAME = s$SEC_NAME)
newdat.lme = data.frame(METHOD = s$METHOD,
MAX_DEPTH_M = rep(seq(0,30,by=0.3),2),
SEC_NAME = s$SEC_NAME)
newdat.lme = data.frame(METHOD = s$METHOD,
MAX_DEPTH_M = rep(seq(0,30,by=0.29),2),
SEC_NAME = s$SEC_NAME)
View(newdat.lme)
head(newdat.lme)
newdat.lme$predlme <- predict(mod, newdata = newdat.lme, re.form = NA)
ggplot(s, aes(x = MAX_DEPTH_M, y = sqAdColDen, color = METHOD) ) +
geom_point(aes(colour = factor(METHOD))) +
geom_line(data = newdat.lme, aes(y = predlme), size = 1)
ggplot(s, aes(x = MAX_DEPTH_M, y = AdColDen, color = METHOD) ) +
geom_point(aes(colour = factor(METHOD))) +
geom_line(data = newdat.lme, aes(y = predlme), size = 1)
newdat.lme$predlme <- predict(mod, newdata = newdat.lme, re.form = NA)
head(newdat.lme)
newdat.lme$predlme <- predict(mod, newdata = newdat.lme, level=0)
mod<-lme(sqAdColDen~METHOD*MAX_DEPTH_M, random = ~1|SEC_NAME,data=s)
newdat.lme$predlme <- predict(mod, newdata = newdat.lme, level=0)
ggplot(s, aes(x = MAX_DEPTH_M, y = sqAdColDen, color = METHOD) ) +
geom_point(aes(colour = factor(METHOD))) +
geom_line(data = newdat.lme, aes(y = predlme), size = 1)
newdat.lme$AdColDen<-newdat.lme$predlme^2
ggplot(s, aes(x = MAX_DEPTH_M, y = AdColDen, color = METHOD) ) +
geom_point(aes(colour = factor(METHOD))) +
geom_line(data = newdat.lme, aes(y = AdColDen), size = 1)
des = model.matrix(formula(mod)[-2], newdat.lme)
head(des)
predvar = diag( des %*% vcov(mod) %*% t(des) )
head(predvar)
newdat.lme$lower = with(newdat.lme, predlme - 2*sqrt(predvar) )
newdat.lme$upper = with(newdat.lme, predlme + 2*sqrt(predvar) )
View(newdat.lme)
newdat.lme$lower<-newdat.lme$lower^2 #back transform predicted values
newdat.lme$upper<-newdat.lme$upper^2 #back transform predicted values
View(newdat.lme)
ggplot(s, aes(x = MAX_DEPTH_M, y = AdColDen, color = METHOD) ) +
geom_point(aes(colour = factor(METHOD))) +
geom_line(data = newdat.lme, aes(y = AdColDen), size = 1)+
geom_ribbon(data = newdat.lme, aes(y = NULL, ymin = lower, ymax = upper,
color = NULL, fill = METHOD),
alpha = .15)
ggplot(s, aes(x = MAX_DEPTH_M, y = AdColDen, color = METHOD) ) +
geom_point(aes(colour = factor(METHOD))) +
geom_line(data = newdat.lme, aes(y = AdColDen), size = 1)+
geom_ribbon(data = newdat.lme, aes(y = NULL, ymin = lower, ymax = upper,
color = NULL, fill = METHOD),alpha = .15)+
theme_bw() +
theme(
axis.text.x = element_text(angle = 90)
,plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank()
,axis.ticks.x = element_blank() # no x axis ticks
,axis.title.x = element_text( vjust = -.0001) # adjust x axis to lower the same amount as the genus labels
,legend.position="none")
labs(x="Max Depth (m)",y="Adult Density/m2")
ggplot(s, aes(x = MAX_DEPTH_M, y = AdColDen, color = METHOD) ) +
geom_point(aes(colour = factor(METHOD))) +
geom_line(data = newdat.lme, aes(y = AdColDen), size = 1)+
geom_ribbon(data = newdat.lme, aes(y = NULL, ymin = lower, ymax = upper,
color = NULL, fill = METHOD),alpha = .15)+
theme_bw() +
theme(
axis.text.x = element_text(angle = 0)
,plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank()
,axis.ticks.x = element_blank() # no x axis ticks
,axis.title.x = element_text( vjust = -.0001) # adjust x axis to lower the same amount as the genus labels
,legend.position="none")+
labs(x="Max Depth (m)",y="Adult Density/m2")
s.wide<-subset(site.wide,GENUS_CODE=="SSSS")
p1<-Plot1to1(s.wide,"Diver_AdColDen","SfM_AdColDen")
#Select columns to keep in SITE data
site.new<-dplyr::select(site, c(METHOD,SITEVISITID,SITE,GENUS_CODE,TRANSECTAREA_ad,TRANSECTAREA_j,AdColCount,AdColDen,JuvColDen,Ave.size,Ave.od,Ave.rd,
BLE_prev,AcuteDZ_prev,ChronicDZ_prev,ISLAND,SEC_NAME,DEPTH_BIN,LATITUDE,LONGITUDE,HABITAT_CODE,
MIN_DEPTH_M,MAX_DEPTH_M))
#site<-subset(site,SITE!="HAW-04285") #sckewed by 1 very very large colony
sfm_site<-subset(site.new,METHOD=="SfM")
diver_site<-subset(site.new,METHOD=="Diver")
##############################START HERE#####################
#Set up in wide format
colnames(sfm_site)[7:15] <- paste("SfM_", colnames(sfm_site[,c(7:15)]), sep = "");sfm_site<-dplyr::select(sfm_site,-c(METHOD,HABITAT_CODE))
colnames(diver_site)[7:15] <- paste("Diver_", colnames(diver_site[,c(7:15)]), sep = "");diver_site<-dplyr::select(diver_site,-c(METHOD,ISLAND,HABITAT_CODE,SEC_NAME,DEPTH_BIN,LATITUDE,LONGITUDE,MIN_DEPTH_M,MAX_DEPTH_M))
site.wide<-merge(sfm_site,diver_site,by=c("SITE","SITEVISITID","GENUS_CODE","TRANSECTAREA_ad","TRANSECTAREA_j"),all=T)
length(unique(site.wide$SITEVISITID)) #should be 104
#################IMPORTANT- CHECK FOR MERGING ERRORS
View(subset(site.wide,GENUS_CODE=="SSSS")) #Make sure columns merge properly
#Merge together and remove sites that aren't merging properly
site.wide<-merge(sfm_site,diver_site,by=c("SITE","SITEVISITID","GENUS_CODE","TRANSECTAREA_ad","TRANSECTAREA_j"))
View(site.wide) ##NOTE- LAN-01819 site 10 SfM is duplicated for some reason-hopefully this will be fixed with final data
# #Change NAs for abunanance and density metrics to 0. Don't change NAs in the partial mortality columns to 0
site.wide$Diver_JuvColDen[is.na(site.wide$Diver_JuvColDen)]<-0
site.wide$Diver_AdColDen[is.na(site.wide$Diver_AdColDen)]<-0
site.wide$SfM_JuvColDen[is.na(site.wide$SfM_JuvColDen)]<-0
site.wide$SfM_AdColDen[is.na(site.wide$SfM_AdColDen)]<-0
head(site.wide)
head(subset(site.wide,GENUS_CODE=="SSSS"))
s.wide<-subset(site.wide,GENUS_CODE=="SSSS")
p1<-Plot1to1(s.wide,"Diver_AdColDen","SfM_AdColDen")
source("T:/Benthic/Data/SfM/ScriptFiles/SfMvDiver Plotting Functions.R")
source("C:/Users/Courtney.S.Couch/Documents/GitHub/Benthic-Scripts/Functions/Benthic_Functions_newApp_vTAOfork.R")
source("C:/Users/Courtney.S.Couch/Documents/GitHub/fish-paste/lib/core_functions.R")
p1<-Plot1to1(s.wide,"Diver_AdColDen","SfM_AdColDen")
p1<-Plot1to1(s.wide,"Diver_AdColDen","SfM_AdColDen")
p1
Plot1to1_new<-function(d,response_variable,predictor_variable){
#sub<-d[d$taxon,]
d$X<-d[,response_variable]
d$Y<-d[,predictor_variable]
mx_val<-max(d$Y, d$X, na.rm = TRUE)
corr<-cor.test(d$X, d$Y, method="pearson")
rmse<-rmse(d$Y, d$X,na.rm=TRUE)
r_text<-paste("RMSE = ", round(rmse,digits = 2),"\n r = ", round((corr$estimate),2), sep="")
p1<-ggplot(d, aes(x=X, y=Y)) +
geom_point(size=1) + 	geom_abline(slope=1, intercept=0) +
geom_smooth(method="lm", color="red", linetype="dashed", se=F) +
geom_text(aes((mx_val/5), (mx_val * 0.9), label=r_text), nudge_y=-0.1, nudge_x=0.1,size=4, color="red") +
theme_bw()+
scale_x_continuous(limits=c(0,mx_val)) +
scale_y_continuous(limits=c(0,mx_val))
return(p1)
} #
p1<-Plot1to1_new(s.wide,"Diver_AdColDen","SfM_AdColDen")
p1
Plot1to1_new<-function(d,response_variable,predictor_variable){
#sub<-d[d$taxon,]
d$X<-d[,response_variable]
d$Y<-d[,predictor_variable]
mx_val<-max(d$Y, d$X, na.rm = TRUE)
corr<-cor.test(d$X, d$Y, method="pearson")
rmse<-rmse(d$Y, d$X,na.rm=TRUE)
r_text<-paste("RMSE = ", round(rmse,digits = 2),"\n r = ", round((corr$estimate),2), sep="")
p1<-ggplot(d, aes(x=X, y=Y)) +
geom_point(size=1) + 	geom_abline(slope=1, intercept=0) +
geom_smooth(method="lm", color="red", linetype="dashed", se=F) +
geom_text(aes((mx_val/5), (mx_val * 0.9), label=r_text), nudge_y=-0.1, nudge_x=0.1,size=4, color="red") +
theme_bw()+
scale_x_continuous(limits=c(0,mx_val)) +
scale_y_continuous(limits=c(0,mx_val)) +
ylab(response_variable) +  xlab(predictor_variable)
return(p1)
} #
p1<-Plot1to1_new(s.wide,"Diver_AdColDen","SfM_AdColDen")
p1
p1<-Plot1to1_new(s.wide,"Diver_AdColDen","SfM_AdColDen")
p1
p2<-ggplot(subset(site,GENUS_CODE=="SSSS"), aes(x=METHOD, y=AdColDen, fill=METHOD)) +
geom_boxplot() +
geom_label(label="NS", x=1.5,y=28,label.size = 0.35,color = "black", fill="white")+
theme_bw() +
theme(
axis.text.x = element_text(angle = 0)
,plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank()
,axis.ticks.x = element_blank() # no x axis ticks
,axis.title.x = element_text( vjust = -.0001) # adjust x axis to lower the same amount as the genus labels
,legend.position="bottom"
,legend.title = element_blank())+
labs(x="Method",y="Mean Adult Density/m2")
p2
p3<-ggplot(subset(site,GENUS_CODE=="SSSS"), aes(x=HAB_R1, y=AdColDen, fill=METHOD)) +
geom_boxplot() +
# guides(fill=FALSE)
theme_bw() +
theme(
axis.text.x = element_text(angle = 90)
,plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank()
,axis.ticks.x = element_blank() # no x axis ticks
,axis.title.x = element_text( vjust = -.0001) # adjust x axis to lower the same amount as the genus labels
,legend.position="bottom"
,legend.title = element_blank())+
labs(x="Habitat Type",y="Mean Adult Density/m2")
p3
#https://aosmith.rbind.io/2018/11/16/plot-fitted-lines/
library(nlme)
mod<-lme(sqAdColDen~METHOD*MAX_DEPTH_M, random = ~1|SEC_NAME,data=s)
newdat.lme = data.frame(METHOD = s$METHOD,
MAX_DEPTH_M = rep(seq(0,30,by=0.29),2),
SEC_NAME = s$SEC_NAME)
head(newdat.lme)
newdat.lme$predlme <- predict(mod, newdata = newdat.lme, level=0)
newdat.lme$AdColDen<-newdat.lme$predlme^2 #back transform predicted values
des = model.matrix(formula(mod)[-2], newdat.lme)
predvar = diag( des %*% vcov(mod) %*% t(des) )
newdat.lme$lower = with(newdat.lme, predlme - 2*sqrt(predvar) )
newdat.lme$upper = with(newdat.lme, predlme + 2*sqrt(predvar) )
newdat.lme$lower<-newdat.lme$lower^2 #back transform predicted values
newdat.lme$upper<-newdat.lme$upper^2 #back transform predicted values
p4<-ggplot(s, aes(x = MAX_DEPTH_M, y = AdColDen, color = METHOD) ) +
geom_point(aes(colour = factor(METHOD))) +
geom_line(data = newdat.lme, aes(y = AdColDen), size = 1)+
geom_ribbon(data = newdat.lme, aes(y = NULL, ymin = lower, ymax = upper,
color = NULL, fill = METHOD),alpha = .15)+
theme_bw() +
theme(
axis.text.x = element_text(angle = 0)
,plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank()
,axis.ticks.x = element_blank() # no x axis ticks
,axis.title.x = element_text( vjust = -.0001) # adjust x axis to lower the same amount as the genus labels
,legend.position="none")+
labs(x="Max Depth (m)",y="Adult Density/m2")
p4
AdColDenS<-grid.arrange(p1,p2,p3,p4,nrow=1,ncol=4)
ggsave(plot<-AdColDenS,file="T:/Benthic/Data/SfM/Method Comparision/Figures/AdColDenSSSS_stats.pdf",width=10,height=5)
library(gridExtra)
AdColDenS<-grid.arrange(p1,p2,p3,p4,nrow=1,ncol=4)
ggsave(plot<-AdColDenS,file="T:/Benthic/Data/SfM/Method Comparision/Figures/AdColDenSSSS_stats.pdf",width=10,height=5)
p3<-ggplot(subset(site,GENUS_CODE=="SSSS"), aes(x=HAB_R1, y=AdColDen, fill=METHOD)) +
geom_boxplot() +
# guides(fill=FALSE)
theme_bw() +
geom_label(label="NS between methods and habitats", x=0.5,y=28,label.size = 0.35,color = "black", fill="white")+
theme(
axis.text.x = element_text(angle = 90)
,plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank()
,axis.ticks.x = element_blank() # no x axis ticks
,axis.title.x = element_text( vjust = -.0001) # adjust x axis to lower the same amount as the genus labels
,legend.position="none")+
labs(x="Habitat Type",y="Mean Adult Density/m2")
p3
p3<-ggplot(subset(site,GENUS_CODE=="SSSS"), aes(x=HAB_R1, y=AdColDen, fill=METHOD)) +
geom_boxplot() +
# guides(fill=FALSE)
theme_bw() +
geom_label(label="NS between methods and habitats", x=4,y=28,label.size = 0.35,color = "black", fill="white")+
theme(
axis.text.x = element_text(angle = 90)
,plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank()
,axis.ticks.x = element_blank() # no x axis ticks
,axis.title.x = element_text( vjust = -.0001) # adjust x axis to lower the same amount as the genus labels
,legend.position="none")+
labs(x="Habitat Type",y="Mean Adult Density/m2")
p3
p3<-ggplot(subset(site,GENUS_CODE=="SSSS"), aes(x=HAB_R1, y=AdColDen, fill=METHOD)) +
geom_boxplot() +
# guides(fill=FALSE)
theme_bw() +
geom_label(label="NS between methods and habitats", x=4,y=28,label.size = 0.35,color = "black", fill="white")+
theme(
axis.text.x = element_text(angle = 90)
,plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank()
,axis.ticks.x = element_blank() # no x axis ticks
,axis.title.x = element_text( vjust = -.0001) # adjust x axis to lower the same amount as the genus labels
,legend.position="none")+
labs(x="Habitat Type",y="Mean Adult Density/m2")
p3
p1<-Plot1to1_new(s.wide,"Diver_AdColDen","SfM_AdColDen")
p1
p2<-ggplot(subset(site,GENUS_CODE=="SSSS"), aes(x=METHOD, y=AdColDen, fill=METHOD)) +
geom_boxplot() +
geom_label(label="NS", x=1.5,y=28,label.size = 0.35,color = "black", fill="white")+
theme_bw() +
theme(
axis.text.x = element_text(angle = 0)
,plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank()
,axis.ticks.x = element_blank() # no x axis ticks
,axis.title.x = element_text( vjust = -.0001) # adjust x axis to lower the same amount as the genus labels
,legend.position="bottom")+
labs(x="Method",y="Mean Adult Density/m2")
p2
p3<-ggplot(subset(site,GENUS_CODE=="SSSS"), aes(x=HAB_R1, y=AdColDen, fill=METHOD)) +
geom_boxplot() +
# guides(fill=FALSE)
theme_bw() +
geom_label(label="NS between methods and habitats", x=4,y=28,label.size = 0.35,color = "black", fill="white")+
theme(
axis.text.x = element_text(angle = 90)
,plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank()
,axis.ticks.x = element_blank() # no x axis ticks
,axis.title.x = element_text( vjust = -.0001) # adjust x axis to lower the same amount as the genus labels
,legend.position="none")+
labs(x="Habitat Type",y="Mean Adult Density/m2")
p3
#https://aosmith.rbind.io/2018/11/16/plot-fitted-lines/
library(nlme)
mod<-lme(sqAdColDen~METHOD*MAX_DEPTH_M, random = ~1|SEC_NAME,data=s)
newdat.lme = data.frame(METHOD = s$METHOD,
MAX_DEPTH_M = rep(seq(0,30,by=0.29),2),
SEC_NAME = s$SEC_NAME)
head(newdat.lme)
newdat.lme$predlme <- predict(mod, newdata = newdat.lme, level=0)
newdat.lme$AdColDen<-newdat.lme$predlme^2 #back transform predicted values
des = model.matrix(formula(mod)[-2], newdat.lme)
predvar = diag( des %*% vcov(mod) %*% t(des) )
newdat.lme$lower = with(newdat.lme, predlme - 2*sqrt(predvar) )
newdat.lme$upper = with(newdat.lme, predlme + 2*sqrt(predvar) )
newdat.lme$lower<-newdat.lme$lower^2 #back transform predicted values
newdat.lme$upper<-newdat.lme$upper^2 #back transform predicted values
p4<-ggplot(s, aes(x = MAX_DEPTH_M, y = AdColDen, color = METHOD) ) +
geom_point(aes(colour = factor(METHOD))) +
geom_line(data = newdat.lme, aes(y = AdColDen), size = 1)+
geom_ribbon(data = newdat.lme, aes(y = NULL, ymin = lower, ymax = upper,
color = NULL, fill = METHOD),alpha = .15)+
theme_bw() +
theme(
axis.text.x = element_text(angle = 0)
,plot.background = element_blank()
,panel.grid.major = element_blank()
,panel.grid.minor = element_blank()
,axis.ticks.x = element_blank() # no x axis ticks
,axis.title.x = element_text( vjust = -.0001) # adjust x axis to lower the same amount as the genus labels
,legend.position="none")+
labs(x="Max Depth (m)",y="Adult Density/m2")
p4
AdColDenS<-grid.arrange(p1,p2,p3,p4,nrow=1,ncol=4)
ggsave(plot<-AdColDenS,file="T:/Benthic/Data/SfM/Method Comparision/Figures/AdColDenSSSS_stats.pdf",width=10,height=5)
